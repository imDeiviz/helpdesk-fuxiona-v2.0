import{r as l,R as oe}from"./react-KkReF98x.js";import{c as De}from"./react-dom-BmMaRgKK.js";import{L as $,c as ze,R as Ae}from"./react-router-dom-DYObKZc4.js";import{B as G,Q as Fe}from"./react-toastify-DDiGtpI2.js";/* empty css                  */import{a as H}from"./axios-D8rVyQy1.js";import{j as e,b as a,F as V}from"./@restart-vWkmgGYT.js";import{c as ie,d as de,f as ce,g as Be,O as ke}from"./react-router-D57byvxf.js";import{C as A,R as T,a as P,b as N,A as ne,F as r,B as L,c as Q,I as _,T as Ne,L as te,M as z,d as re,N as K,e as W}from"./react-bootstrap-BMxV8v2E.js";import{L as Te,F as Z,C as Re,A as se,a as je,B as ue,P as pe,S as ve,b as Me,c as ye,X as Ue,d as Ge,T as fe,e as Oe,U as me,M as $e,f as qe,g as xe,h as _e,i as we,j as Ce,k as Ve,l as He,m as Ke,n as Ye,o as Xe,p as We,H as Qe,q as Je,r as Ze}from"./lucide-react-Bwi12BTD.js";import{R as ge,P as ea,a as aa,T as be,B as ta,C as ra,X as na,Y as sa,b as ia}from"./recharts-CPe_8HIj.js";import"./classnames-WHzQcnmQ.js";import"./scheduler-C323NY8X.js";import"./@remix-run-BGoq0L6a.js";import"./clsx-B-dksMZM.js";import"./dom-helpers-MowH48zo.js";import"./dequal-tFQomdd2.js";import"./@popperjs-gBMG6YgA.js";import"./warning-CAje6-Ce.js";import"./@react-aria-BFuhqHJJ.js";import"./uncontrollable-C6GMRLV7.js";import"./@babel-CnxlMfeK.js";import"./prop-types-D1kEb061.js";import"./react-transition-group-2nYMKGNC.js";import"./lodash-C4e-2tT5.js";import"./tiny-invariant-BaFNuDhB.js";import"./d3-shape-nwul2LtV.js";import"./d3-path-CimkQT29.js";import"./react-smooth-CKlGIIiQ.js";import"./fast-equals-BIyco3rD.js";import"./victory-vendor-eFgrrWDw.js";import"./d3-scale-DCNNTN8k.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-g_qRI3rN.js";import"./d3-time-format-j2_s_XYn.js";import"./d3-time-g9mLz1m7.js";import"./d3-interpolate-CvRPKVI0.js";import"./d3-color-9lF95FHy.js";import"./d3-format-CzD4bSOQ.js";import"./recharts-scale-CEDTliZZ.js";import"./decimal.js-light-ZKFLnszB.js";import"./eventemitter3-CaYdTFqo.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))s(m);new MutationObserver(m=>{for(const o of m)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function h(m){const o={};return m.integrity&&(o.integrity=m.integrity),m.referrerPolicy&&(o.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?o.credentials="include":m.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(m){if(m.ep)return;m.ep=!0;const o=h(m);fetch(m.href,o)}})();const Y="https://tu-api.fly.dev/api/v1",la=[{value:"Malaga",label:"Málaga"},{value:"Marbella",label:"Marbella"},{value:"Fuengirola",label:"Fuengirola"}],he=[{value:"Baja",label:"Baja",color:"success"},{value:"Media",label:"Media",color:"warning"},{value:"Alta",label:"Alta",color:"danger"}],ca=[{value:"user",label:"Usuario"},{value:"admin",label:"Administrador"},{value:"tecnico",label:"Técnico"}],Se=l.createContext(),X=()=>l.useContext(Se),oa=({children:t})=>{const[i,h]=l.useState(null),[s,m]=l.useState(!0),[o,f]=l.useState(null);l.useEffect(()=>{(async()=>{try{m(!0);const v=await H.get(`${Y}/users/me`,{withCredentials:!0});v.status===200&&h(v.data)}catch(v){console.error("Not authenticated",v),h(null)}finally{m(!1)}})()},[]);const g={user:i,loading:s,error:o,login:async(I,v)=>{var u,c,y,n;try{if(m(!0),f(null),(await H.post(`${Y}/sessions`,{email:I,password:v},{withCredentials:!0})).status===200){const b=await H.get(`${Y}/users/me`,{withCredentials:!0});return h(b.data),G.success("Login successful!"),!0}}catch(d){return console.error("Login error:",d),f(((c=(u=d.response)==null?void 0:u.data)==null?void 0:c.message)||"Login failed. Please check your credentials."),G.error(((n=(y=d.response)==null?void 0:y.data)==null?void 0:n.message)||"Login failed. Please check your credentials."),!1}finally{m(!1)}},logout:async()=>{try{m(!0),await H.delete(`${Y}/sessions`,{withCredentials:!0}),h(null),G.success("Logged out successfully")}catch(I){console.error("Logout error:",I),G.error("Error during logout")}finally{m(!1)}},register:async I=>{var v,u,c,y;try{if(m(!0),f(null),(await H.post(`${Y}/users`,I)).status===201)return G.success("Registration successful! Please login."),!0}catch(n){return console.error("Registration error:",n),f(((u=(v=n.response)==null?void 0:v.data)==null?void 0:u.message)||"Registration failed. Please try again."),G.error(((y=(c=n.response)==null?void 0:c.data)==null?void 0:y.message)||"Registration failed. Please try again."),!1}finally{m(!1)}},isAuthenticated:!!i};return e(Se.Provider,{value:g,children:t})},R=({size:t="medium"})=>{const h={...(()=>{switch(t){case"small":return{width:"20px",height:"20px",border:"2px solid rgba(176, 0, 232, 0.1)"};case"large":return{width:"60px",height:"60px",border:"6px solid rgba(176, 0, 232, 0.1)"};case"medium":default:return{width:"40px",height:"40px",border:"4px solid rgba(176, 0, 232, 0.1)"}}})(),borderRadius:"50%",borderTopColor:"#b000e8",animation:"spin 1s ease-in-out infinite"};return e("div",{className:"d-flex justify-content-center align-items-center",children:e("div",{className:"spinner",style:h})})},da=()=>{var u,c;const[t,i]=l.useState(""),[h,s]=l.useState(""),[m,o]=l.useState(!1),{login:f,loading:S,error:E}=X(),C=ie(),I=((c=(u=de().state)==null?void 0:u.from)==null?void 0:c.pathname)||"/dashboard",v=async y=>{if(y.preventDefault(),y.currentTarget.checkValidity()===!1){y.stopPropagation(),o(!0);return}await f(t,h)&&C(I,{replace:!0})};return e(A,{fluid:!0,className:"bg-light min-vh-100 d-flex align-items-center justify-content-center py-5",children:e(T,{className:"justify-content-center w-100",children:e(P,{xs:12,sm:10,md:8,lg:6,xl:4,children:e(N,{className:"border-0 shadow-lg fade-in",children:a(N.Body,{className:"p-5",children:[a("div",{className:"text-center mb-4",children:[e("h2",{className:"fw-bold",style:{color:"#b000e8"},children:"Helpdesk Portal"}),e("p",{className:"text-muted",children:"Inicia sesión para acceder al sistema"})]}),E&&e(ne,{variant:"danger",className:"mb-4",children:E}),a(r,{noValidate:!0,validated:m,onSubmit:v,children:[a(r.Group,{className:"mb-3",controlId:"formEmail",children:[e(r.Label,{children:"Correo electrónico"}),e(r.Control,{type:"email",placeholder:"Ingresa tu correo",autoComplete:"username",value:t,onChange:y=>i(y.target.value),required:!0,disabled:S}),e(r.Control.Feedback,{type:"invalid",children:"Por favor ingresa un correo electrónico válido."})]}),a(r.Group,{className:"mb-4",controlId:"formPassword",children:[e(r.Label,{children:"Contraseña"}),e(r.Control,{type:"password",placeholder:"Ingresa tu contraseña",autoComplete:"current-password",value:h,onChange:y=>s(y.target.value),required:!0,disabled:S}),e(r.Control.Feedback,{type:"invalid",children:"Por favor ingresa tu contraseña."})]}),e(L,{variant:"primary",type:"submit",className:"w-100 py-2 mb-3",disabled:S,children:S?e(R,{size:"small"}):a(V,{children:[e(Te,{size:18,className:"me-2"}),"Iniciar Sesión"]})})]}),e("div",{className:"text-center mt-4",children:e("p",{className:"text-muted mb-0",children:"¿No tienes una cuenta? Contacta con el administrador."})})]})})})})})},ma=({children:t})=>{const{isAuthenticated:i,loading:h}=X(),s=de();return h?e("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:e(R,{})}):i?t:e(ce,{to:"/login",state:{from:s},replace:!0})},M=H.create({baseURL:Y,headers:{"Content-Type":"application/json"},withCredentials:!0});M.interceptors.request.use(t=>t,t=>Promise.reject(t));M.interceptors.response.use(t=>t,t=>{var h;const i=(h=t.response)==null?void 0:h.status;return i===401?(G.error("Session expired. Please login again."),window.location.href="/login"):i===403?G.error("You do not have permission to perform this action."):i===404?G.error("Resource not found."):i===500?G.error("Server error. Please try again later."):t.response||G.error("Network error. Please check your connection."),Promise.reject(t)});const le={getAllUsers:()=>M.get("/users"),createUser:t=>M.post("/users",t),deleteUser:t=>M.delete(`/users/${t}`)},O={getAllIncidents:()=>M.get("/incidents"),getIncidentById:t=>M.get(`/incidents/${t}`),createIncident:t=>M.post("/incidents",t,{headers:{"Content-Type":"multipart/form-data"}}),updateIncident:(t,i)=>M.patch(`/incidents/${t}`,i),deleteIncident:t=>M.delete(`/incidents/${t}`),addFiles:(t,i)=>M.patch(`/incidents/${t}/files`,i,{headers:{"Content-Type":"multipart/form-data"}}),removeFile:(t,i)=>M.delete(`/incidents/${t}/files`,{data:{public_id:i}})},ha=()=>{const{user:t}=X(),[i,h]=l.useState([]),[s,m]=l.useState(!0),[o,f]=l.useState({pending:0,inProgress:0,resolved:0}),[S,E]=l.useState(null),[C,g]=l.useState({total:0,pending:0,inProgress:0,resolved:0,byPriority:{Alta:0,Media:0,Baja:0}});l.useEffect(()=>{(async()=>{try{m(!0);const c=await O.getAllIncidents();h(c.data);const y=c.data.length,n=x=>{const ee=new Date(x),ae=new Date;return ee.getMonth()===ae.getMonth()&&ee.getFullYear()===ae.getFullYear()},d=c.data.filter(x=>x.status==="Pendiente").length,b=c.data.filter(x=>x.status==="En Progreso").length,k=c.data.filter(x=>x.status==="Resuelto"&&n(x.createdAt)).length,F=c.data.filter(x=>x.status!=="Resuelto"&&!n(x.createdAt)).length,p=c.data.filter(x=>x.status==="Pendiente"||x.status==="En Progreso"),D=c.data.filter(x=>x.status==="Pendiente").length,j=c.data.filter(x=>x.status==="En Progreso").length,U=c.data.filter(x=>x.status==="Resuelto").length;f({pending:D,inProgress:j,resolved:U+F});const q={Alta:p.filter(x=>x.priority==="Alta").length,Media:p.filter(x=>x.priority==="Media").length,Baja:p.filter(x=>x.priority==="Baja").length};g({total:y,pending:d,inProgress:b,resolved:k,byPriority:q})}catch(c){console.error("Error fetching incidents:",c),E("Error al cargar las incidencias. Por favor, intenta de nuevo más tarde.")}finally{m(!1)}})()},[]);const I=[{name:"Alta",value:C.byPriority.Alta,fill:"#dc3545"},{name:"Media",value:C.byPriority.Media,fill:"#fd7e14"},{name:"Baja",value:C.byPriority.Baja,fill:"#198754"}],v=i.sort((u,c)=>new Date(c.createdAt)-new Date(u.createdAt)).slice(0,5);return s?e(A,{className:"py-5",children:e("div",{className:"text-center py-5",children:e(R,{})})}):S?e(A,{className:"py-5",children:e("div",{className:"alert alert-danger",children:S})}):a(A,{fluid:!0,children:[a("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e("h1",{className:"mb-0",children:"Dashboard"}),a("div",{children:[e("span",{className:"text-muted me-2",children:"Bienvenido,"}),e("span",{className:"fw-bold",children:t==null?void 0:t.name})]})]}),a(T,{className:"g-4 mb-4",children:[e(P,{md:6,lg:3,children:e(N,{className:"h-100 border-0 shadow-sm stat-card",children:a(N.Body,{className:"d-flex align-items-center",children:[e("div",{className:"rounded-circle bg-primary bg-opacity-10 p-3 me-3",children:e(Z,{size:24,className:"text-primary"})}),a("div",{children:[e("h6",{className:"text-muted mb-1",children:"Total Incidencias"}),e("h3",{className:"mb-0",children:C.total})]})]})})}),e(P,{md:6,lg:3,children:e(N,{className:"h-100 border-0 shadow-sm stat-card",children:a(N.Body,{className:"d-flex align-items-center",children:[e("div",{className:"rounded-circle bg-warning bg-opacity-10 p-3 me-3",children:e(Re,{size:24,className:"text-warning"})}),a("div",{children:[e("h6",{className:"text-muted mb-1",children:"Pendientes"}),e("h3",{className:"mb-0",children:C.pending})]})]})})}),e(P,{md:6,lg:3,children:e(N,{className:"h-100 border-0 shadow-sm stat-card",children:a(N.Body,{className:"d-flex align-items-center",children:[e("div",{className:"rounded-circle bg-info bg-opacity-10 p-3 me-3",children:e(se,{size:24,className:"text-info"})}),a("div",{children:[e("h6",{className:"text-muted mb-1",children:"En Progreso"}),e("h3",{className:"mb-0",children:C.inProgress})]})]})})}),e(P,{md:6,lg:3,children:e(N,{className:"h-100 border-0 shadow-sm stat-card",children:a(N.Body,{className:"d-flex align-items-center",children:[e("div",{className:"rounded-circle bg-success bg-opacity-10 p-3 me-3",children:e(je,{size:24,className:"text-success"})}),a("div",{children:[e("h6",{className:"text-muted mb-1",children:"Resueltas"}),e("h3",{className:"mb-0",children:C.resolved})]})]})})})]}),a(T,{className:"g-4",children:[e(P,{lg:5,children:e(N,{className:"border-0 shadow-sm h-100",children:a(N.Body,{children:[a("h5",{className:"card-title mb-0",children:[e(ue,{size:20,className:"me-2"}),"Incidencias por Estado"]}),e("div",{style:{height:"300px"},children:e(ge,{width:"100%",height:"100%",children:a(ea,{children:[e(aa,{data:[{name:"Pendientes",value:o.pending/(o.pending+o.inProgress+o.resolved)*100,fill:"#fd7e14"},{name:"En Progreso",value:o.inProgress/(o.pending+o.inProgress+o.resolved)*100,fill:"#007bff"},{name:"Resueltas",value:o.resolved/(o.pending+o.inProgress+o.resolved)*100,fill:"#28a745"}],dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",label:({percent:u})=>`${(u*100).toFixed(2)}%`,labelLine:!1}),e(be,{formatter:u=>`${u.toFixed(2)}%`})]})})})]})})}),e(P,{lg:7,children:e(N,{className:"border-0 shadow-sm h-100",children:a(N.Body,{children:[e("div",{className:"d-flex justify-content-between align-items-center mb-4",children:a("h5",{className:"card-title mb-0",children:[e(ue,{size:20,className:"me-2"}),"Incidencias por Prioridad"]})}),e("div",{style:{height:"300px"},children:e(ge,{width:"100%",height:"100%",children:a(ta,{data:I,margin:{top:5,right:30,left:20,bottom:5},children:[e(ra,{strokeDasharray:"3 3"}),e(na,{dataKey:"name"}),e(sa,{}),e(be,{}),e(ia,{dataKey:"value",fill:"#b000e8"})]})})})]})})}),e(P,{lg:5,children:e(N,{className:"border-0 shadow-sm h-100",children:a(N.Body,{children:[a("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e("h5",{className:"card-title mb-0",children:"Incidencias Recientes"}),e($,{to:"/incidents",className:"btn btn-sm btn-outline-primary",children:"Ver todas"})]}),v.length>0?e("div",{className:"list-group list-group-flush",children:v.map(u=>a($,{to:`/incidents/${u._id}`,className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center px-0 py-3 border-bottom",children:[a("div",{children:[e("h6",{className:"mb-1",children:u.title}),a("small",{className:"text-muted",children:[new Date(u.createdAt).toLocaleDateString()," - ",u.office]})]}),e(Q,{bg:u.priority==="Alta"?"danger":u.priority==="Media"?"warning":"success",children:u.priority})]},u._id))}):e("div",{className:"text-center py-4",children:e("p",{className:"text-muted mb-0",children:"No hay incidencias recientes"})})]})})})]})]})},ua=()=>{const[t,i]=l.useState([]),[h,s]=l.useState([]),[m,o]=l.useState(!0),[f,S]=l.useState(null),[E,C]=l.useState(""),[g,I]=l.useState({priority:"",office:"",status:"",startDate:"",endDate:""});l.useEffect(()=>{(async()=>{try{o(!0);const d=await O.getAllIncidents({params:{}});i(d.data),s(d.data)}catch(d){console.error("Error fetching incidents:",d),S("Error al cargar las incidencias. Por favor, intenta de nuevo más tarde.")}finally{o(!1)}})()},[]),l.useEffect(()=>{let n=t;if(E){const d=E.toLowerCase();n=n.filter(b=>b.title.toLowerCase().includes(d)||b.description.toLowerCase().includes(d)||b.name.toLowerCase().includes(d)||b.email.toLowerCase().includes(d))}if(g.priority&&(n=n.filter(d=>d.priority===g.priority)),g.office&&(n=n.filter(d=>d.office===g.office)),g.status&&(n=n.filter(d=>d.status===g.status)),g.startDate&&g.endDate){const d=new Date(g.startDate),b=new Date(g.endDate);n=n.filter(k=>{const F=new Date(k.createdAt);return F.toDateString()===d.toDateString()||F.toDateString()===b.toDateString()||F>=d&&F<=b}),n=n.filter(k=>{const F=new Date(k.createdAt);return F.toDateString()===d.toDateString()||F.toDateString()===b.toDateString()||F>=d&&F<=b})}else g.startDate&&(n=n.filter(d=>new Date(d.createdAt).toDateString()===new Date(g.startDate).toDateString()));s(n)},[E,g,t]);const v=async(n,d)=>{try{await O.updateIncident(n,{status:d}),fetchIncidents()}catch(b){console.error("Error updating incident status:",b)}},u=n=>{const{name:d,value:b}=n.target;I(k=>({...k,[d]:b}))},c=()=>{I({priority:"",office:"",status:"",startDate:"",endDate:""}),C("")},y=[...new Set(t.map(n=>n.office))];return m?e(A,{className:"py-5",children:e("div",{className:"text-center py-5",children:e(R,{})})}):f?e(A,{className:"py-5",children:e("div",{className:"alert alert-danger",children:f})}):a(A,{fluid:!0,children:[a("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[a("h1",{className:"mb-0",children:[e(Z,{size:28,className:"me-2"}),"Incidencias"]}),a($,{to:"/incidents/create",className:"btn btn-primary",children:[e(pe,{size:18,className:"me-1"}),"Nueva Incidencia"]})]}),e(N,{className:"border-0 shadow-sm mb-4",children:e(N.Body,{children:a(T,{className:"g-3",children:[e(P,{md:6,lg:4,children:a(_,{children:[e(_.Text,{children:e(ve,{size:18})}),e(r.Control,{placeholder:"Buscar incidencias...",value:E,onChange:n=>C(n.target.value)})]})}),e(P,{md:6,lg:8,children:a("div",{className:"d-flex gap-2 flex-wrap",children:[a(r.Select,{name:"priority",value:g.priority,onChange:u,className:"w-auto",children:[e("option",{value:"",children:"Todas las prioridades"}),he.map(n=>e("option",{value:n.value,children:n.label},n.value))]}),a(r.Select,{name:"office",value:g.office,onChange:u,className:"w-auto",children:[e("option",{value:"",children:"Todas las oficinas"}),y.map(n=>e("option",{value:n,children:n},n))]}),a(r.Select,{name:"status",value:g.status,onChange:u,className:"w-auto",children:[e("option",{value:"",children:"Todos los estados"}),e("option",{value:"Pendiente",children:"Pendiente"}),e("option",{value:"En Progreso",children:"En Progreso"}),e("option",{value:"Resuelto",children:"Resuelto"})]}),a(r.Group,{className:"w-auto",children:[e(r.Label,{children:"Desde"}),e(r.Control,{type:"date",name:"startDate",value:g.startDate,onChange:u})]}),a(r.Group,{className:"w-auto",children:[e(r.Label,{children:"Hasta"}),e(r.Control,{type:"date",name:"endDate",value:g.endDate,onChange:u})]}),e(L,{variant:"outline-secondary",onClick:c,children:"Limpiar"})]})})]})})}),e(N,{className:"border-0 shadow-sm",children:e(N.Body,{className:"p-0",children:h.length>0?e("div",{className:"table-responsive",children:a(Ne,{hover:!0,className:"mb-0",children:[e("thead",{className:"bg-light",children:a("tr",{children:[e("th",{children:"Título"}),e("th",{children:"Oficina"}),e("th",{children:"Solicitante"}),e("th",{children:"Fecha"}),e("th",{children:"Prioridad"}),e("th",{children:"Estado"}),e("th",{children:"Acciones"})]})}),e("tbody",{children:h.map(n=>a("tr",{children:[e("td",{children:e($,{to:`/incidents/${n._id}`,className:"text-decoration-none",children:n.title})}),e("td",{children:n.office}),e("td",{children:n.name}),e("td",{children:new Date(n.createdAt).toLocaleDateString()}),e("td",{children:e(Q,{bg:n.priority==="Alta"?"danger":n.priority==="Media"?"warning":"success",children:n.priority})}),e("td",{onClick:()=>v(n._id,"En Progreso"),children:e(Q,{bg:n.status==="Pendiente"?"secondary":n.status==="En Progreso"?"info":"success",children:n.status||"Pendiente"})}),e("td",{children:e($,{to:`/incidents/${n._id}`,className:"btn btn-sm btn-outline-primary",children:"Ver"})})]},n._id))})]})}):a("div",{className:"text-center py-5",children:[e(Me,{size:48,className:"text-muted mb-3"}),e("h5",{children:"No se encontraron incidencias"}),e("p",{className:"text-muted",children:"Intenta con otros filtros o crea una nueva incidencia"}),a($,{to:"/incidents/create",className:"btn btn-primary mt-2",children:[e(pe,{size:18,className:"me-1"}),"Nueva Incidencia"]})]})})})]})},pa=()=>{const{user:t}=X(),{id:i}=Be(),h=ie(),[s,m]=l.useState(null),[o,f]=l.useState(!0),[S,E]=l.useState(null),[C,g]=l.useState(!1),[I,v]=l.useState({}),[u,c]=l.useState(!1),[y,n]=l.useState(!1),[d,b]=l.useState([]),[k,F]=l.useState(!1),[p,D]=l.useState(null),[j,U]=l.useState(!1);l.useEffect(()=>{(async()=>{try{f(!0);const B=await O.getIncidentById(i);m(B.data.incident),v({title:B.data.incident.title,description:B.data.incident.description,priority:B.data.incident.priority,status:B.data.incident.status||"Pendiente"})}catch(B){console.error("Error fetching incident:",B),E("Error al cargar la incidencia. Por favor, intenta de nuevo más tarde.")}finally{f(!1)}})()},[i]);const q=()=>{g(!C),C||v({title:s.title,description:s.description,priority:s.priority,status:s.status||"Pendiente"})},x=w=>{const{name:B,value:J}=w.target;v(Le=>({...Le,[B]:J}))},ee=async()=>{try{f(!0);const w=await O.updateIncident(i,{...I,files:s.files});m(w.data.incident),g(!1)}catch(w){console.error("Error updating incident:",w),E("Error al actualizar la incidencia. Por favor, intenta de nuevo más tarde.")}finally{f(!1)}},ae=async()=>{try{if(f(!0),s.files&&s.files.length>0)for(const w of s.files)await O.removeFile(i,w.public_id);await O.deleteIncident(i),h("/incidents")}catch(w){console.error("Error deleting incident:",w),E("Error al eliminar la incidencia. Por favor, intenta de nuevo más tarde."),f(!1)}},Pe=w=>{b(Array.from(w.target.files))},Ie=async()=>{if(d.length!==0)try{F(!0);const w=new FormData;d.forEach(J=>{w.append("files",J)});const B=await O.addFiles(i,w);m(B.data.incident),n(!1),b([])}catch(w){console.error("Error uploading files:",w),E("Error al subir los archivos. Por favor, intenta de nuevo más tarde.")}finally{F(!1)}},Ee=async()=>{if(p)try{f(!0);const w=await O.removeFile(i,p);m(B=>({...B,files:B.files.filter(J=>J.public_id!==p)})),m(w.data.incident),U(!1),D(null)}catch(w){console.error("Error deleting file:",w),E("Error al eliminar el archivo. Por favor, intenta de nuevo más tarde.")}finally{f(!1)}};return o&&!s?e(A,{className:"py-5",children:e("div",{className:"text-center py-5",children:e(R,{})})}):S?e(A,{className:"py-5",children:e("div",{className:"alert alert-danger",children:S})}):s?a(A,{fluid:!0,children:[a("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[a("h1",{className:"mb-0",children:[e(Z,{size:28,className:"me-2"}),"Detalle de Incidencia"]}),e("div",{children:C?a(V,{children:[a(L,{variant:"success",className:"me-2",onClick:ee,disabled:o,children:[e(ye,{size:18,className:"me-1"}),"Guardar"]}),a(L,{variant:"outline-secondary",onClick:q,children:[e(Ue,{size:18,className:"me-1"}),"Cancelar"]})]}):e(V,{children:t.role!=="user"&&a(V,{children:[a(L,{variant:"primary",className:"me-2",onClick:q,children:[e(Ge,{size:18,className:"me-1"}),"Editar"]}),a(L,{variant:"danger",onClick:()=>c(!0),children:[e(fe,{size:18,className:"me-1"}),"Eliminar"]})]})})})]}),a(T,{className:"g-4",children:[e(P,{lg:8,children:e(N,{className:"border-0 shadow-sm mb-4",children:e(N.Body,{children:C?a(r,{children:[a(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Título"}),e(r.Control,{type:"text",name:"title",value:I.title,onChange:x,required:!0})]}),a(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Descripción"}),e(r.Control,{as:"textarea",rows:5,name:"description",value:I.description,onChange:x,required:!0})]}),a(T,{children:[e(P,{md:6,children:a(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Prioridad"}),e(r.Select,{name:"priority",value:I.priority,onChange:x,children:he.map(w=>e("option",{value:w.value,children:w.label},w.value))})]})}),e(P,{md:6,children:a(r.Group,{className:"mb-3",children:[e(r.Label,{children:"Estado"}),a(r.Select,{name:"status",value:I.status,onChange:x,children:[e("option",{value:"Pendiente",children:"Pendiente"}),e("option",{value:"En Progreso",children:"En Progreso"}),e("option",{value:"Resuelto",children:"Resuelto"})]})]})})]})]}):a(V,{children:[a("div",{className:"d-flex justify-content-between mb-3",children:[e("h3",{className:"mb-0",children:s.title}),a("div",{children:[e(Q,{bg:s.priority==="Alta"?"danger":s.priority==="Media"?"warning":"success",className:"me-2",children:s.priority}),e(Q,{bg:s.status==="Pendiente"?"secondary":s.status==="En Progreso"?"info":"success",children:s.status||"Pendiente"})]})]}),a("div",{className:"mb-4",children:[a("div",{className:"d-flex mb-2",children:[e(Oe,{size:18,className:"text-muted me-2"}),a("span",{className:"text-muted",children:["Creado el ",new Date(s.createdAt).toLocaleDateString("es-ES")," a las ",new Date(s.createdAt).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]})]}),a("div",{className:"d-flex mb-2",children:[e(me,{size:18,className:"text-muted me-2"}),a("span",{className:"text-muted",children:["Solicitante: ",s.name," (",s.email,")"]})]}),a("div",{className:"d-flex",children:[e($e,{size:18,className:"text-muted me-2"}),a("span",{className:"text-muted",children:["Oficina: ",s.office]})]})]}),e("h5",{className:"mb-3",children:"Descripción"}),e("p",{className:"mb-0",style:{whiteSpace:"pre-line"},children:s.description})]})})})}),e(P,{lg:4,children:e(N,{className:"border-0 shadow-sm mb-4",children:a(N.Body,{children:[a("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[a("h5",{className:"mb-0",children:[e(qe,{size:18,className:"me-2"}),"Archivos Adjuntos"]}),a(L,{variant:"outline-primary",size:"sm",onClick:()=>n(!0),children:[e(xe,{size:16,className:"me-1"}),"Subir"]})]}),s.files&&s.files.length>0?e(te,{variant:"flush",children:s.files.map((w,B)=>a(te.Item,{className:"d-flex justify-content-between align-items-center px-0 py-2 border-bottom",children:[e("a",{href:w.url,target:"_blank",rel:"noopener noreferrer",className:"text-decoration-none text-truncate",style:{maxWidth:"80%"},children:w.public_id.split("/").pop()}),e(L,{variant:"link",className:"text-danger p-0",onClick:()=>{D(w.public_id),U(!0)},children:e(fe,{size:16})})]},B))}):e("div",{className:"text-center py-4",children:e("p",{className:"text-muted mb-0",children:"No hay archivos adjuntos"})})]})})})]}),a(z,{show:u,onHide:()=>c(!1),centered:!0,children:[e(z.Header,{closeButton:!0,children:e(z.Title,{children:"Confirmar Eliminación"})}),e(z.Body,{children:a("div",{className:"text-center mb-4",children:[e(se,{size:48,className:"text-danger mb-3"}),e("h5",{children:"¿Estás seguro de eliminar esta incidencia?"}),e("p",{className:"text-muted",children:"Esta acción no se puede deshacer."})]})}),a(z.Footer,{children:[e(L,{variant:"secondary",onClick:()=>c(!1),children:"Cancelar"}),e(L,{variant:"danger",onClick:ae,disabled:o,children:o?e(R,{size:"small"}):"Eliminar"})]})]}),a(z,{show:y,onHide:()=>n(!1),centered:!0,children:[e(z.Header,{closeButton:!0,children:e(z.Title,{children:"Subir Archivos"})}),a(z.Body,{children:[a(r.Group,{controlId:"formFiles",className:"mb-3",children:[e(r.Label,{children:"Selecciona los archivos"}),e(r.Control,{type:"file",multiple:!0,onChange:Pe,disabled:k}),e(r.Text,{className:"text-muted",children:"Formatos permitidos: jpg, png, pdf, doc, docx, xls, xlsx, txt, zip, rar"})]}),d.length>0&&a("div",{className:"mt-3",children:[e("h6",{children:"Archivos seleccionados:"}),e(te,{variant:"flush",children:d.map((w,B)=>a(te.Item,{className:"px-0 py-1 border-0",children:[w.name," (",(w.size/1024).toFixed(2)," KB)"]},B))})]})]}),a(z.Footer,{children:[e(L,{variant:"secondary",onClick:()=>n(!1),children:"Cancelar"}),e(L,{variant:"primary",onClick:Ie,disabled:k||d.length===0,children:k?e(R,{size:"small"}):"Subir"})]})]}),a(z,{show:j,onHide:()=>U(!1),centered:!0,children:[e(z.Header,{closeButton:!0,children:e(z.Title,{children:"Confirmar Eliminación"})}),e(z.Body,{children:a("div",{className:"text-center mb-4",children:[e(se,{size:48,className:"text-danger mb-3"}),e("h5",{children:"¿Estás seguro de eliminar este archivo?"}),e("p",{className:"text-muted",children:"Esta acción no se puede deshacer."})]})}),a(z.Footer,{children:[e(L,{variant:"secondary",onClick:()=>U(!1),children:"Cancelar"}),e(L,{variant:"danger",onClick:Ee,disabled:o,children:o?e(R,{size:"small"}):"Eliminar"})]})]})]}):e(A,{className:"py-5",children:e("div",{className:"alert alert-warning",children:"Incidencia no encontrada"})})},fa=()=>{const t=ie(),[i,h]=l.useState({title:"",description:"",priority:"Baja"}),[s,m]=l.useState([]),[o,f]=l.useState(!1),[S,E]=l.useState(!1),[C,g]=l.useState(null),I=c=>{const{name:y,value:n}=c.target;h(d=>({...d,[y]:n}))},v=c=>{m(Array.from(c.target.files))},u=async c=>{var n,d;if(c.preventDefault(),c.currentTarget.checkValidity()===!1){c.stopPropagation(),f(!0);return}try{E(!0),g(null);const b=new FormData;b.append("title",i.title),b.append("description",i.description),b.append("priority",i.priority),s.length>0&&s.forEach(F=>{b.append("files",F)});const k=await O.createIncident(b,{headers:{"Content-Type":"multipart/form-data"}});t(`/incidents/${k.data.id}`)}catch(b){console.error("Error creating incident:",b),g(((d=(n=b.response)==null?void 0:n.data)==null?void 0:d.message)||"Error al crear la incidencia. Por favor, intenta de nuevo más tarde.")}finally{E(!1)}};return a(A,{fluid:!0,children:[a("div",{className:"d-flex align-items-center mb-4",children:[e(L,{variant:"link",className:"p-0 me-3",onClick:()=>t("/incidents"),children:e(_e,{size:24})}),a("h1",{className:"mb-0",children:[e(Z,{size:28,className:"me-2"}),"Nueva Incidencia"]})]}),C&&e(ne,{variant:"danger",className:"mb-4",children:C}),e(N,{className:"border-0 shadow-sm",children:e(N.Body,{className:"p-4",children:a(r,{noValidate:!0,validated:o,onSubmit:u,children:[a(T,{children:[e(P,{md:8,children:a(r.Group,{className:"mb-3",controlId:"formTitle",children:[e(r.Label,{children:"Título"}),e(r.Control,{type:"text",name:"title",value:i.title,onChange:I,placeholder:"Ingresa un título descriptivo",required:!0,disabled:S}),e(r.Control.Feedback,{type:"invalid",children:"El título es obligatorio."})]})}),e(P,{md:4,children:a(r.Group,{className:"mb-3",controlId:"formPriority",children:[e(r.Label,{children:"Prioridad"}),e(r.Select,{name:"priority",value:i.priority,onChange:I,disabled:S,children:he.map(c=>e("option",{value:c.value,children:c.label},c.value))})]})})]}),a(r.Group,{className:"mb-4",controlId:"formDescription",children:[e(r.Label,{children:"Descripción"}),e(r.Control,{as:"textarea",rows:5,name:"description",value:i.description,onChange:I,placeholder:"Describe detalladamente la incidencia",required:!0,disabled:S}),e(r.Control.Feedback,{type:"invalid",children:"La descripción es obligatoria."})]}),a(r.Group,{controlId:"formFiles",className:"mb-4",children:[e(r.Label,{children:"Archivos Adjuntos (Opcional)"}),e(r.Control,{type:"file",multiple:!0,onChange:v,disabled:S}),e(r.Text,{className:"text-muted",children:"Formatos permitidos: jpg, png, pdf, doc, docx, xls, xlsx, txt, zip, rar"})]}),s.length>0&&a("div",{className:"mb-4",children:[e("h6",{children:"Archivos seleccionados:"}),e("ul",{className:"list-unstyled",children:s.map((c,y)=>a("li",{className:"mb-1",children:[e(xe,{size:16,className:"me-2 text-primary"}),c.name," (",(c.size/1024).toFixed(2)," KB)"]},y))})]}),a("div",{className:"d-flex justify-content-end",children:[e(L,{variant:"secondary",className:"me-2",onClick:()=>t("/incidents"),disabled:S,children:"Cancelar"}),e(L,{variant:"primary",type:"submit",disabled:S,children:S?e(R,{size:"small"}):e(V,{children:"Crear Incidencia"})})]})]})})})]})},ga=()=>{const{user:t,loading:i}=X(),[h,s]=l.useState(!1),[m,o]=l.useState(!1),[f,S]=l.useState(null),[E,C]=l.useState({currentPassword:"",newPassword:""}),g=v=>{const{name:u,value:c}=v.target;C(y=>({...y,[u]:c}))},I=async v=>{var u,c;v.preventDefault(),s(!0),S(null),o(!1);try{await H.patch(`${Y}/users/change-password`,E,{withCredentials:!0}),o(!0),C({currentPassword:"",newPassword:""})}catch(y){S(((c=(u=y.response)==null?void 0:u.data)==null?void 0:c.message)||"Error al cambiar la contraseña. Por favor, intenta de nuevo más tarde.")}finally{s(!1)}};return i?e(A,{className:"py-5",children:e("div",{className:"text-center py-5",children:e(R,{})})}):a(A,{fluid:!0,children:[e("h1",{className:"mb-4",children:"Mi Perfil"}),m&&e(ne,{variant:"success",className:"mb-4",children:"Contraseña actualizada correctamente."}),f&&e(ne,{variant:"danger",className:"mb-4",children:f}),a(T,{className:"g-4",children:[e(P,{lg:4,children:e(N,{className:"border-0 shadow-sm h-100",children:a(N.Body,{className:"text-center p-4",children:[e("div",{className:"rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center mx-auto mb-4",style:{width:"120px",height:"120px"},children:e(me,{size:60,className:"text-primary"})}),e("h4",{className:"mb-1",children:t==null?void 0:t.name}),e("p",{className:"text-muted mb-3",children:t==null?void 0:t.email}),a("div",{className:"d-flex justify-content-center align-items-center",children:[e(we,{size:18,className:"text-muted me-2"}),e("span",{children:t==null?void 0:t.office})]})]})})}),e(P,{lg:8,children:e(N,{className:"border-0 shadow-sm",children:a(N.Body,{className:"p-4",children:[e("h5",{className:"mb-4",children:"Informacion de Usuario"}),a(r,{onSubmit:I,children:[a(T,{className:"mb-3",children:[e(P,{md:6,children:a(r.Group,{controlId:"formName",children:[e(r.Label,{children:"Nombre"}),e(r.Control,{type:"text",defaultValue:t==null?void 0:t.name,disabled:!0})]})}),e(P,{md:6,children:a(r.Group,{controlId:"formEmail",children:[e(r.Label,{children:"Correo Electrónico"}),e(r.Control,{type:"email",defaultValue:t==null?void 0:t.email,disabled:!0})]})})]}),a(T,{className:"mb-3",children:[e(P,{md:6,children:a(r.Group,{controlId:"formOffice",children:[e(r.Label,{children:"Oficina"}),e(r.Control,{type:"text",defaultValue:t==null?void 0:t.office,disabled:!0})]})}),e(P,{md:6,children:a(r.Group,{controlId:"formRole",children:[e(r.Label,{children:"Rol"}),e(r.Control,{type:"text",defaultValue:(t==null?void 0:t.role)||"Usuario",disabled:!0})]})})]}),e("hr",{className:"my-4"}),e("h5",{className:"mb-4",children:"Cambiar Contraseña"}),e(T,{className:"mb-3",children:e(P,{md:6,children:a(r.Group,{controlId:"formCurrentPassword",children:[e(r.Label,{children:"Contraseña Actual"}),e(r.Control,{type:"password",name:"currentPassword",placeholder:"Inserta contraseña actual",value:E.currentPassword,onChange:g,required:!0})]})})}),e(T,{className:"mb-4",children:e(P,{md:6,children:a(r.Group,{controlId:"formNewPassword",children:[e(r.Label,{children:"Nueva Contraseña"}),e(r.Control,{type:"password",name:"newPassword",placeholder:"Inserta nueva contraseña",value:E.newPassword,onChange:g,required:!0})]})})}),e("div",{className:"d-flex justify-content-end",children:e(L,{variant:"primary",type:"submit",disabled:h,children:h?e(R,{size:"small"}):a(V,{children:[e(ye,{size:18,className:"me-2"}),"Guardar Cambios"]})})})]})]})})})]})]})},ba=()=>{const[t,i]=l.useState([]),[h,s]=l.useState([]),[m,o]=l.useState(!0),[f,S]=l.useState(null),[E,C]=l.useState(!1),[g,I]=l.useState(""),[v,u]=l.useState({name:"",email:"",password:"",role:"user",office:"Malaga"}),[c,y]=l.useState(!1),[n,d]=l.useState(!1);l.useEffect(()=>{(async()=>{try{o(!0);const D=await le.getAllUsers();i(D.data),s(D.data)}catch(D){console.error("Error fetching users:",D),S("Error al cargar los usuarios. Por favor, intenta de nuevo más tarde.")}finally{o(!1)}})()},[]),l.useEffect(()=>{if(g){const p=g.toLowerCase(),D=t.filter(j=>j.name.toLowerCase().includes(p)||j.email.toLowerCase().includes(p)||j.office.toLowerCase().includes(p));s(D)}else s(t)},[g,t]);const b=p=>{const{name:D,value:j}=p.target;u(U=>({...U,[D]:j}))},k=async p=>{var j,U;if(p.preventDefault(),p.currentTarget.checkValidity()===!1){p.stopPropagation(),y(!0);return}try{d(!0);const q=await le.createUser(v);i(x=>[...x,q.data.user]),u({name:"",email:"",password:"",role:"user",office:"Malaga"}),y(!1),C(!1)}catch(q){console.error("Error creating user:",q),S(((U=(j=q.response)==null?void 0:j.data)==null?void 0:U.message)||"Error al crear el usuario. Por favor, intenta de nuevo más tarde.")}finally{d(!1)}},F=async p=>{if(window.confirm("¿Estás seguro de que deseas eliminar este usuario?"))try{await le.deleteUser(p),i(t.filter(D=>D.id!==p)),s(h.filter(D=>D.id!==p))}catch(D){console.error("Error deleting user:",D),S("Error al eliminar el usuario. Por favor, intenta de nuevo más tarde.")}};return m&&t.length===0?e(A,{className:"py-5",children:e("div",{className:"text-center py-5",children:e(R,{})})}):f?e(A,{className:"py-5",children:e("div",{className:"alert alert-danger",children:f})}):a(A,{fluid:!0,children:[a("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[a("h1",{className:"mb-0",children:[e(Ce,{size:28,className:"me-2"}),"Usuarios"]}),a(L,{variant:"primary",onClick:()=>C(!0),children:[e(Ve,{size:18,className:"me-1"}),"Nuevo Usuario"]})]}),e(N,{className:"border-0 shadow-sm mb-4",children:e(N.Body,{children:a(_,{children:[e(_.Text,{children:e(ve,{size:18})}),e(r.Control,{placeholder:"Buscar usuarios...",value:g,onChange:p=>I(p.target.value)})]})})}),e(N,{className:"border-0 shadow-sm",children:e(N.Body,{className:"p-0",children:h.length>0?e("div",{className:"table-responsive",children:a(Ne,{hover:!0,className:"mb-0",children:[e("thead",{className:"bg-light",children:a("tr",{children:[e("th",{children:"Nombre"}),e("th",{children:"Correo Electrónico"}),e("th",{children:"Oficina"}),e("th",{children:"Rol"}),e("th",{children:"Acciones"})]})}),e("tbody",{children:h.map(p=>a("tr",{children:[e("td",{children:p.name}),e("td",{children:p.email}),e("td",{children:p.office}),e("td",{children:e(Q,{bg:p.role==="admin"?"danger":p.role==="tecnico"?"info":"secondary",children:p.role==="admin"?"Administrador":p.role==="tecnico"?"Técnico":"Usuario"})}),e("td",{children:e(L,{variant:"danger",onClick:()=>F(p.id),children:e(He,{size:18})})})]},p.id))})]})}):a("div",{className:"text-center py-5",children:[e(se,{size:48,className:"text-muted mb-3"}),e("h5",{children:"No se encontraron usuarios"}),e("p",{className:"text-muted",children:"Intenta con otra búsqueda o crea un nuevo usuario"})]})})}),a(z,{show:E,onHide:()=>{C(!1),y(!1)},centered:!0,children:[e(z.Header,{closeButton:!0,children:e(z.Title,{children:"Crear Nuevo Usuario"})}),e(z.Body,{children:a(r,{noValidate:!0,validated:c,onSubmit:k,children:[a(r.Group,{className:"mb-3",controlId:"formName",children:[e(r.Label,{children:"Nombre"}),e(r.Control,{type:"text",name:"name",value:v.name,onChange:b,placeholder:"Ingresa el nombre completo",required:!0,disabled:n}),e(r.Control.Feedback,{type:"invalid",children:"El nombre es obligatorio."})]}),a(r.Group,{className:"mb-3",controlId:"formEmail",children:[e(r.Label,{children:"Correo Electrónico"}),a(_,{children:[e(_.Text,{children:e(Ke,{size:16})}),e(r.Control,{type:"email",name:"email",value:v.email,onChange:b,placeholder:"ejemplo@correo.com",required:!0,disabled:n})]}),e(r.Control.Feedback,{type:"invalid",children:"Ingresa un correo electrónico válido."})]}),a(r.Group,{className:"mb-3",controlId:"formPassword",children:[e(r.Label,{children:"Contraseña"}),e(r.Control,{type:"password",name:"password",value:v.password,onChange:b,placeholder:"Mínimo 8 caracteres",required:!0,disabled:n}),e(r.Text,{className:"text-muted",children:"La contraseña debe tener al menos 8 caracteres, incluyendo letras y números."}),e(r.Control.Feedback,{type:"invalid",children:"La contraseña es obligatoria."})]}),a(T,{children:[e(P,{md:6,children:a(r.Group,{className:"mb-3",controlId:"formRole",children:[e(r.Label,{children:"Rol"}),e(r.Select,{name:"role",value:v.role,onChange:b,disabled:n,children:ca.map(p=>e("option",{value:p.value,children:p.label},p.value))})]})}),e(P,{md:6,children:a(r.Group,{className:"mb-3",controlId:"formOffice",children:[e(r.Label,{children:"Oficina"}),a(_,{children:[e(_.Text,{children:e(we,{size:16})}),e(r.Select,{name:"office",value:v.office,onChange:b,disabled:n,children:la.map(p=>e("option",{value:p.value,children:p.label},p.value))})]})]})})]}),a("div",{className:"d-flex justify-content-end mt-4",children:[e(L,{variant:"secondary",className:"me-2",onClick:()=>{C(!1),y(!1)},disabled:n,children:"Cancelar"}),e(L,{variant:"primary",type:"submit",disabled:n,children:n?e(R,{size:"small"}):e(V,{children:"Crear Usuario"})})]})]})})]})]})},Na=({toggleSidebar:t})=>{const{user:i,logout:h}=X(),s=ie(),m=async()=>{await h(),s("/login")};return e(re,{bg:"white",expand:"lg",className:"shadow-sm",style:{zIndex:1e3},children:a(A,{fluid:!0,children:[a("div",{className:"d-flex align-items-center",children:[e("button",{className:"btn btn-link text-dark me-3 d-flex align-items-center",onClick:t,"aria-label":"Toggle sidebar",children:e(Ye,{size:20})}),a(re.Brand,{as:$,to:"/dashboard",className:"d-flex align-items-center",children:[e("span",{style:{color:"#b000e8",fontWeight:"bold"},children:"Helpdesk"}),e("span",{className:"ms-1 fw-light",children:"Portal"})]})]}),e(re.Toggle,{"aria-controls":"basic-navbar-nav"}),e(re.Collapse,{id:"basic-navbar-nav",children:a(K,{className:"ms-auto",children:[e(K.Link,{as:$,to:"/incidents/create",className:"btn btn-primary text-white mx-2",children:"Crear Incidencia"}),e(W,{title:e("div",{className:"d-inline-block",children:e(Xe,{size:18,className:"me-1"})}),id:"notification-dropdown",align:"end",children:e(W.Item,{className:"text-center",children:"No hay notificaciones"})}),a(W,{title:a("div",{className:"d-inline-block",children:[e(me,{size:18,className:"me-1"}),e("span",{children:(i==null?void 0:i.name)||"Usuario"})]}),id:"user-dropdown",align:"end",children:[e(W.Item,{as:$,to:"/profile",children:"Mi Perfil"}),e(W.Divider,{}),a(W.Item,{onClick:m,children:[e(We,{size:16,className:"me-2"}),"Cerrar Sesión"]})]})]})})]})})},va=({isOpen:t})=>{const i=de(),{user:h}=X(),s=(h==null?void 0:h.role)==="admin";h==null||h.role;const m=[{path:"/dashboard",name:"Dashboard",icon:e(Ze,{size:18}),access:!0},{path:"/incidents",name:"Incidencias",icon:e(Z,{size:18}),access:!0},{path:"/users",name:"Usuarios",icon:e(Ce,{size:18}),access:s}],o=f=>f.access&&a(K.Link,{as:$,to:f.path,className:`mb-2 d-flex align-items-center ${i.pathname===f.path?"active bg-primary bg-opacity-25 text-white":"text-white"}`,style:{borderRadius:"8px",padding:"10px",transition:"all 0.2s"},children:[e("span",{className:"me-3 position-relative",style:{zIndex:1},children:f.icon}),t&&e("span",{className:"text-white position-relative",style:{zIndex:1},children:f.name})]},f.path);return a("div",{className:"bg-dark text-white h-100 d-flex flex-column",children:[a("div",{className:"p-3",children:[t&&e("h5",{className:"text-white-50 mb-3 px-2",children:"Menú Principal"}),e(K,{className:"flex-column",children:m.map(o)})]}),a("div",{className:"mt-auto p-3",children:[t&&e("h5",{className:"text-white-50 mb-3 px-2",children:"Soporte"}),a(K,{className:"flex-column",children:[a(K.Link,{href:"#help",className:"mb-2 d-flex align-items-center text-white-50",style:{borderRadius:"8px",padding:"10px",transition:"all 0.2s"},children:[e("span",{className:"me-3",children:e(Qe,{size:18})}),t&&e("span",{children:"Ayuda"})]}),a(K.Link,{href:"#settings",className:"mb-2 d-flex align-items-center text-white-50",style:{borderRadius:"8px",padding:"10px",transition:"all 0.2s"},children:[e("span",{className:"me-3",children:e(Je,{size:18})}),t&&e("span",{children:"Configuración"})]})]}),t&&a("div",{className:"mt-4 p-3 bg-primary bg-opacity-10 rounded",children:[e("p",{className:"small text-white-50 mb-1",children:"Oficina actual"}),e("p",{className:"mb-0 text-white",children:(h==null?void 0:h.office)||"No asignada"})]})]})]})},ya=()=>{const[t,i]=oe.useState(!0);return a("div",{className:"d-flex flex-column min-vh-100",children:[e(Na,{toggleSidebar:()=>{i(!t)}}),e(A,{fluid:!0,className:"flex-grow-1",children:a(T,{className:"h-100",children:[e(P,{md:t?3:1,lg:t?2:1,className:"px-0 bg-dark sidebar-container",style:{transition:"all 0.3s ease",height:"calc(100vh - 56px)",position:"sticky",top:"56px"},children:e(va,{isOpen:t})}),e(P,{md:t?9:11,lg:t?10:11,className:"py-4 px-md-4",style:{transition:"all 0.3s ease"},children:e("div",{className:"slide-in",children:e(ke,{})})})]})})]})},xa=[{path:"/login",element:e(da,{})},{path:"/",element:e(ma,{children:e(ya,{})}),children:[{index:!0,element:e(ce,{to:"/dashboard",replace:!0})},{path:"dashboard",element:e(ha,{})},{path:"incidents",element:e(ua,{})},{path:"incidents/:id",element:e(pa,{})},{path:"incidents/create",element:e(fa,{})},{path:"profile",element:e(ga,{})},{path:"users",element:e(ba,{})}]},{path:"*",element:e(ce,{to:"/login",replace:!0})}],wa=ze(xa,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0}});function Ca(){const[t,i]=oe.useState(null);return e(Ae,{router:wa,children:e(Fe,{position:"top-right",autoClose:3e3})})}De.createRoot(document.getElementById("root")).render(e(oe.StrictMode,{children:e(oa,{children:e(Ca,{})})}));
